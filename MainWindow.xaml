<Window x:Class="MinsPDFViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="MinsPDFViewer - Pro" Height="800" Width="1200"
        Focusable="True">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Popup Name="SelectionPopup" Placement="Mouse" StaysOpen="False" AllowsTransparency="True">
            <Border Background="White" CornerRadius="8" BorderBrush="Gray" BorderThickness="1" Padding="5">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                </Border.Effect>
                <StackPanel Orientation="Horizontal">
                    <Button Click="BtnCopy_Click" Background="Transparent" BorderThickness="0" ToolTip="텍스트 복사" Margin="2">
                        <StackPanel>
                            <TextBlock Text="📄" HorizontalAlignment="Center" FontSize="16"/>
                            <TextBlock Text="복사" FontSize="10"/>
                        </StackPanel>
                    </Button>
                    <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}"/>
                    <Button Click="BtnHighlightYellow_Click" Background="Transparent" BorderThickness="0" ToolTip="노란색 형광펜" Margin="2">
                        <StackPanel>
                            <Border Width="20" Height="20" Background="#FFFF00" CornerRadius="2" BorderBrush="Gray" BorderThickness="1"/>
                            <TextBlock Text="형광" FontSize="10" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Click="BtnHighlightOrange_Click" Background="Transparent" BorderThickness="0" ToolTip="주황색 형광펜" Margin="2">
                        <StackPanel>
                            <Border Width="20" Height="20" Background="#FFAA00" CornerRadius="2" BorderBrush="Gray" BorderThickness="1"/>
                            <TextBlock Text="주황" FontSize="10" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Click="BtnUnderline_Click" Background="Transparent" BorderThickness="0" ToolTip="밑줄" Margin="2">
                        <StackPanel>
                            <Grid Width="20" Height="20">
                                <TextBlock Text="U" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <Border BorderBrush="Black" BorderThickness="0,0,0,2" VerticalAlignment="Bottom" Height="2"/>
                            </Grid>
                            <TextBlock Text="밑줄" FontSize="10" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Border>
        </Popup>

        <Border Grid.Row="0" Background="#f0f0f0" Padding="10">
            <StackPanel Orientation="Horizontal">
                <Button Name="BtnOpen" Content="📂 열기" Width="60" Click="BtnOpen_Click" Margin="0,0,10,0"/>
                
                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="5,0"/>
                <Button Name="BtnFitWidth" Content="↔ 너비 맞춤" Width="80" Click="BtnFitWidth_Click" Margin="5,0"/>
                <Button Name="BtnFitHeight" Content="↕ 세로 맞춤" Width="80" Click="BtnFitHeight_Click" Margin="5,0"/>
                
                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="5,0"/>
                <Button Content="-" Width="30" Click="BtnZoomOut_Click"/>
                <TextBlock Name="TxtZoom" Text="100%" VerticalAlignment="Center" Margin="5,0" Width="40" TextAlignment="Center"/>
                <Button Content="+" Width="30" Click="BtnZoomIn_Click"/>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="10,0"/>
                <TextBox Name="TxtSearch" Width="150" VerticalContentAlignment="Center" Margin="0,0,5,0" KeyDown="TxtSearch_KeyDown"/>
                <Button Name="BtnSearch" Content="🔍 검색" Width="60" Click="BtnSearch_Click"/>
                <TextBlock Name="TxtStatus" VerticalAlignment="Center" Margin="10,0,0,0" Foreground="Gray"/>
            </StackPanel>
        </Border>

        <ListView Name="PdfListView" Grid.Row="1" Background="#505050" 
                  ScrollViewer.HorizontalScrollBarVisibility="Auto"
                  Padding="20" BorderThickness="0"
                  VirtualizingPanel.ScrollUnit="Pixel"
                  PreviewMouseWheel="PdfListView_PreviewMouseWheel">
            
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                    <Setter Property="Margin" Value="0,0,0,30"/>
                    <Setter Property="Padding" Value="0"/>
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ListViewItem">
                                <ContentPresenter/>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ListView.ItemContainerStyle>

            <ListView.LayoutTransform>
                <ScaleTransform x:Name="ViewScaleTransform" ScaleX="1.0" ScaleY="1.0"/>
            </ListView.LayoutTransform>

            <ListView.ItemTemplate>
                <DataTemplate>
                    <Grid>
                        <Image Source="{Binding ImageSource}" Stretch="Uniform" Width="{Binding Width}" Height="{Binding Height}">
                            <Image.Effect>
                                <DropShadowEffect BlurRadius="15" ShadowDepth="5" Opacity="0.4"/>
                            </Image.Effect>
                        </Image>
                        
                        <Canvas Width="{Binding Width}" Height="{Binding Height}">
                            <ItemsControl ItemsSource="{Binding Annotations}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <Canvas/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                
                                <ItemsControl.ItemContainerStyle>
                                    <Style TargetType="ContentPresenter">
                                        <Setter Property="Canvas.Left" Value="{Binding X}"/>
                                        <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                                    </Style>
                                </ItemsControl.ItemContainerStyle>

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Width="{Binding Width}" Height="{Binding Height}" 
                                                Background="{Binding Background}"
                                                BorderBrush="{Binding BorderBrush}"
                                                BorderThickness="{Binding BorderThickness}"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Canvas>

                        <Canvas Width="{Binding Width}" Height="{Binding Height}" Visibility="{Binding IsSelecting, Converter={StaticResource BooleanToVisibilityConverter}}">
                             <Rectangle Canvas.Left="{Binding SelectionRect.X}" Canvas.Top="{Binding SelectionRect.Y}"
                                        Width="{Binding SelectionRect.Width}" Height="{Binding SelectionRect.Height}"
                                        Fill="#500000FF" Stroke="Blue" StrokeThickness="1"/>
                        </Canvas>

                        <Canvas Width="{Binding Width}" Height="{Binding Height}" Background="Transparent"
                                Tag="{Binding PageIndex}"
                                MouseLeftButtonDown="Page_MouseDown"
                                MouseMove="Page_MouseMove"
                                MouseLeftButtonUp="Page_MouseUp"/>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </Grid>
</Window>